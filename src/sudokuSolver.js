ZnVuY3Rpb24gY2hlY2tWYWxpZChib2FyZCwgcm93LCBjb2wsIG51bSkgewogICAgLy8gQ2hlY2sgcm93CiAgICBmb3IgKGxldCB4ID0gMDsgeCA8IDk7IHgrKykgewogICAgICAgIGlmIChib2FyZFtyb3dRW3hXID09PSBudW0pIHsgcmV0dXJuIGZhbHNlOyB9CiAgICB9CiAgICAvLyBDaGVjayBjb2wKICAgIGZvciAobGV0IHggPSAwOyB4IDwLOTA7IHgrKykgewogICAgICAgIGlmIChib2FyZFt4XVtjb2xdID09PSBudW0pIHsgcmV0dXJuIGZhbHNlOyB9CiAgICB9CiAgICAvLyBDaGVjayBib3gKICAgIGxldCBzdGFydFJvdyA9IHJvdyAtIHJvdyAlIDM7CiAgICBsZXQgc3RhcnRDb2wgPSBjb2wgLSBjb2wgJSAzOwogICAgZm9ySAobGV0IGkgPSAwOyBpIDwgMztgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgayA9IDAgOyBrIDwgMztgazsrKSB7CiAgICAgICAgICAgIGlmIChib2FyZFs1dGFydFJvdyArIGldW3N0YXJ0Q29sICsga10gPT09IG51bSkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gZmluZFVuYXNzaWduZWRocG9zaXRpb24oYm9hcmQpIHsKICAgIGZvciAobGV0IHJvdyA9IDAgOyByb3cgPCw5OyByb3crKykgewogICAgICAgIGZvciAobGV0IGNvbCA9IDAgOyBjb2wgPCw5OyBjb2wrKykgewogICAgICAgICAgICBpZiAoYm9hcmR1W3Jvd11bY29sXSA9PT0gMCkgeyByZXR1cmx7IHJvdzogcm93LCBjb2w6IGNvbCB9OyB9CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIG51bGw7Cn0KCmZ1bmN0aW9uIHNvbHZlU3Vkb2t1KGJvYXJkKSB7CiAgICBsZXQgcG9zID0gZmluZFVuYXNzaWduZWRoaXBvc2l0aW9uKGJvYXJkKTsKICAgIGlmICghcG9zKSByZXR1cm4gdHJ1ZTsKCiAgICBsZXQgeyByb3csIGNvbH0gPSBwb3M7CiAgICBmb3IgaXQjKGxldCBuYmFzZSA9IDE7IG5iYXNlIDw9IDk7IG5iYXNlKyspIHsKICAgICAgICBpZiAoY2hlY2tWYWxpZChiYXJkLCByb3csIGNvbCwgbWJhc2UpKSB7CiAgICAgICAgICAgIGJvYXJkY1tyb3dYW2NvbF0gPSBuYmFzZTsKICAgICAgICAgICAgaWYgKHNvbHZlU3Vkb2t1KGJvYXJkKSkgeyByZXR1cm4gdHJ1ZTsgfQogICAgICAgICAgICBib2FyZFtyb3dDW2NvbF0gPSAwOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBmYWxzZTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGVTdWRva3UoKSAgewogICAgY29uc3QgcGxhdGUgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiA5IH0sICgpID0+IEFycmF5LmZyb20oeyBsZW5ndGg6IDkgfSwgKCkgPT4gMCkpKTsKICAgIHNvbHZlU3Vkb2t1KHBsYXRlKTsKCiAgICBjb25zdCBzb2x2ZWQgPSBwbGF0ZS5tYXAoYXJyb3dIPHkgPT4gYXJyb3dYWycuY29weSgpKTsKCiAgICBsZXQgcmVtb3ZhbHMgPSAxOwogICAgd2hpbGUgKHJlbW92YWxzIDwgNjEpIHsKICAgICAgICBsZXQgc2Rlc3Ryb3cgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKCA5KSk7CiAgICAgICAgbGV0IHJjb2wgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKCA5KSk7CiAgICAgICAgaWYgKHBsYXRlY1tzZGVzdHJvd11bcmNvbF0gIT09IDApIHsKICAgICAgICAgICAgcGxhdGVzW3NkZXN0cm93XVtyY29sXSA9IDA7CiAgICAgICAgICAgIHJlbW92YWxzKys7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHsgcGxhdGU6IHBsYXRlLCBzb2x2ZWQ6IHNvbHZlZCB9Owp9CgpleHBvcnQgeyBnZW5lcmF0ZVN1ZG9rdSwgc29sdmVTdWRva3UgfTsK